(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[933],{21468:(e,s,t)=>{Promise.resolve().then(t.bind(t,30141)),Promise.resolve().then(t.bind(t,25903)),Promise.resolve().then(t.bind(t,55110)),Promise.resolve().then(t.bind(t,75011))},30141:(e,s,t)=>{"use strict";t.d(s,{default:()=>T});var a=t(73365),r=t(46583),n=t(65521),l=t(42258),i=t(85515),c=t(58005),d=t(31198),o=t(59534),m=t.n(o);function u(e){let{row:s,actions:t}=e;if(t)return(0,a.jsxs)(d.rI,{children:[(0,a.jsx)(d.ty,{asChild:!0,children:(0,a.jsxs)(c.$,{onClick:e=>e.stopPropagation(),variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[(0,a.jsx)(i.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Open menu"})]})}),(0,a.jsx)(d.SQ,{align:"end",className:"w-[160px]",children:t.map((e,t)=>(0,a.jsx)(d._2,{onClick:t=>{var a;t.stopPropagation(),null==(a=e.onClick)||a.call(e,s.original)},className:"cursor-pointer",children:e.path?(0,a.jsx)(m(),{className:"w-full",onClick:t=>{var a;t.stopPropagation(),null==(a=e.onClick)||a.call(e,s.original)},href:e.path(s.original),children:e.label}):(0,a.jsxs)(a.Fragment,{children:[e.label,e.shortcut&&(0,a.jsx)(d.V0,{children:e.shortcut})]})},t))})]})}let x=e=>[{accessorKey:"name",header:e=>{let{column:s}=e;return(0,a.jsx)(l.w,{column:s,title:"Name"})},cell:e=>{let{row:s}=e;return s.original.name}},{accessorKey:"environment",header:e=>{let{column:s}=e;return(0,a.jsx)(l.w,{column:s,title:"Environment"})},cell:e=>{let{row:s}=e;return s.original.environment}},{id:"actions",cell:s=>{let{row:t}=s;return(0,a.jsx)(u,{row:t,actions:e})}}];var j=t(94868),h=t(23060),p=t(1521),f=t(46465),y=t(14130),v=t(47629),N=t(43155),b=t(93149),g=t(58491),w=t(61836),k=t(20544),C=t(25092);let F=(0,t(82934).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),S=p.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(C.b,{ref:s,className:(0,y.cn)(F(),t),...r})});S.displayName=C.b.displayName;let K=p.createContext({}),E=e=>{let{...s}=e;return(0,a.jsx)(K.Provider,{value:{name:s.name},children:(0,a.jsx)(b.xI,{...s})})},R=()=>{let e=p.useContext(K),s=p.useContext(I),{getFieldState:t,formState:a}=(0,b.xW)(),r=t(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:n}=s;return{id:n,name:e.name,formItemId:"".concat(n,"-form-item"),formDescriptionId:"".concat(n,"-form-item-description"),formMessageId:"".concat(n,"-form-item-message"),...r}},I=p.createContext({}),V=p.forwardRef((e,s)=>{let{className:t,...r}=e,n=p.useId();return(0,a.jsx)(I.Provider,{value:{id:n},children:(0,a.jsx)("div",{ref:s,className:(0,y.cn)("space-y-2",t),...r})})});V.displayName="FormItem";let O=p.forwardRef((e,s)=>{let{className:t,...r}=e,{error:n,formItemId:l}=R();return(0,a.jsx)(S,{ref:s,className:(0,y.cn)(n&&"text-destructive",t),htmlFor:l,...r})});O.displayName="FormLabel";let A=p.forwardRef((e,s)=>{let{...t}=e,{error:r,formItemId:n,formDescriptionId:l,formMessageId:i}=R();return(0,a.jsx)(k.DX,{ref:s,id:n,"aria-describedby":r?"".concat(l," ").concat(i):"".concat(l),"aria-invalid":!!r,...t})});A.displayName="FormControl",p.forwardRef((e,s)=>{let{className:t,...r}=e,{formDescriptionId:n}=R();return(0,a.jsx)("p",{ref:s,id:n,className:(0,y.cn)("text-[0.8rem] text-muted-foreground",t),...r})}).displayName="FormDescription";let P=p.forwardRef((e,s)=>{let{className:t,children:r,...n}=e,{error:l,formMessageId:i}=R(),c=l?String(null==l?void 0:l.message):r;return c?(0,a.jsx)("p",{ref:s,id:i,className:(0,y.cn)("text-[0.8rem] font-medium text-destructive",t),...n,children:c}):null});P.displayName="FormMessage";var $=t(21201);let Y=g.Ik({namespace:g.Yj().min(1,"Namespace is required"),keyName:g.Yj().min(1,"Key Name is required"),entries:g.YO(g.Ik({key:g.Yj().min(1,"Key is required"),value:g.Yj().min(1,"Value is required")}))});function _(e){let{open:s,onClose:t,onSubmit:r,isLoading:n}=e,l=(0,b.mN)({resolver:(0,w.u)(Y),defaultValues:{namespace:"",keyName:"",entries:[]}}),i=async e=>{await r(e),l.reset()},d=e=>{let s=[...l.getValues("entries")];s.splice(e,1),l.setValue("entries",s)};return(0,a.jsx)(v.lG,{open:s,onOpenChange:t,children:(0,a.jsxs)(v.Cf,{children:[(0,a.jsx)(v.c7,{children:(0,a.jsx)(v.L3,{children:"Add Key Ring"})}),(0,a.jsx)(b.Op,{...l,children:(0,a.jsxs)("form",{onSubmit:l.handleSubmit(i),className:"space-y-4",children:[(0,a.jsx)(E,{control:l.control,name:"namespace",render:e=>{let{field:s}=e;return(0,a.jsxs)(V,{children:[(0,a.jsx)(O,{children:"Namespace"}),(0,a.jsx)(A,{children:(0,a.jsx)(N.p,{placeholder:"Namespace",...s})}),(0,a.jsx)(P,{})]})}}),(0,a.jsx)(E,{control:l.control,name:"keyName",render:e=>{let{field:s}=e;return(0,a.jsxs)(V,{children:[(0,a.jsx)(O,{children:"Key Name"}),(0,a.jsx)(A,{children:(0,a.jsx)(N.p,{placeholder:"Key Name",...s})}),(0,a.jsx)(P,{})]})}}),l.watch("entries").map((e,s)=>(0,a.jsxs)("div",{className:"flex gap-2 items-start",children:[(0,a.jsx)(E,{control:l.control,name:"entries.".concat(s,".key"),render:e=>{let{field:s}=e;return(0,a.jsxs)(V,{children:[(0,a.jsx)(A,{children:(0,a.jsx)(N.p,{placeholder:"Key",...s})}),(0,a.jsx)(P,{})]})}}),(0,a.jsx)(E,{control:l.control,name:"entries.".concat(s,".value"),render:e=>{let{field:s}=e;return(0,a.jsxs)(V,{children:[(0,a.jsx)(A,{children:(0,a.jsx)(N.p,{placeholder:"Value",...s})}),(0,a.jsx)(P,{})]})}}),(0,a.jsx)(c.$,{type:"button",variant:"destructive",className:"mb-auto",onClick:()=>d(s),children:(0,a.jsx)($.A,{className:"h-4 w-4"})})]},s)),(0,a.jsxs)(c.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{l.setValue("entries",[...l.getValues("entries"),{key:"",value:""}])},className:"w-full",children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Add Entry"]}),(0,a.jsx)(v.Es,{children:(0,a.jsx)(c.$,{type:"submit",disabled:n,className:"w-full",children:n?"Creating...":"Create"})})]})})]})})}var q=t(18159);let D=g.Ik({entries:g.YO(g.Ik({key:g.Yj().min(1,"Key is required"),value:g.Yj().min(1,"Value is required")}))});function L(e){var s,t;let{open:r,onClose:n,onSubmit:l,initialData:i,isLoading:d}=e,o=(0,b.mN)({resolver:(0,w.u)(D),defaultValues:{entries:null!=(s=i.entries)?s:[]}}),m=async e=>{let s={};e.entries.forEach(e=>{let{key:t,value:a}=e;s[t]=a}),await l(s),o.reset({entries:e.entries})},u=null!=(t=o.watch("entries"))?t:[],x=e=>{let s=[...u];s.splice(e,1),o.setValue("entries",s)};return r?(0,a.jsxs)(q.Zp,{className:"max-w-3xl mx-auto mt-8",children:[(0,a.jsx)(q.aR,{children:(0,a.jsx)(q.ZB,{children:"Edit Key"})}),(0,a.jsx)(q.Wu,{children:(0,a.jsx)(b.Op,{...o,children:(0,a.jsxs)("form",{onSubmit:o.handleSubmit(m),className:"space-y-4",children:[u.map((e,s)=>(0,a.jsxs)("div",{className:"flex gap-2 items-start",children:[(0,a.jsx)(E,{control:o.control,name:"entries.".concat(s,".key"),render:e=>{let{field:s}=e;return(0,a.jsxs)(V,{className:"flex-1",children:[(0,a.jsx)(A,{children:(0,a.jsx)(N.p,{placeholder:"Key",...s})}),(0,a.jsx)(P,{})]})}}),(0,a.jsx)(E,{control:o.control,name:"entries.".concat(s,".value"),render:e=>{let{field:s}=e;return(0,a.jsxs)(V,{className:"flex-1",children:[(0,a.jsx)(A,{children:(0,a.jsx)(N.p,{placeholder:"Value",...s})}),(0,a.jsx)(P,{})]})}}),(0,a.jsx)(c.$,{type:"button",variant:"destructive",className:"mb-auto",onClick:()=>x(s),children:(0,a.jsx)($.A,{className:"h-4 w-4"})})]},s)),(0,a.jsxs)(c.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{o.setValue("entries",[...u,{key:"",value:""}])},children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Add Entry"]}),(0,a.jsxs)("div",{className:"flex justify-between pt-6",children:[(0,a.jsx)(c.$,{type:"button",variant:"secondary",onClick:n,children:"Cancel"}),(0,a.jsx)(c.$,{type:"submit",disabled:d||!o.formState.isDirty,children:d?"Saving...":"Save"})]})]})})})]}):null}var H=t(93263),z=t(99345),M=t(94617);function T(){let[e,s]=(0,p.useState)(!1),{connected:t}=(0,j.vT)(),{toast:l}=(0,f.dj)(),{token:i,selectedEnv:d,environments:o}=(0,z.O)(),[m,u]=(0,p.useState)(),v=o.find(e=>e.id==d),N=null==v?void 0:v.providerId,{provider:b}=(0,j.u9)(N),{keyRings:g,fetchKeyRings:w,isLoading:k}=function(e,s,t){let[a,n]=(0,p.useState)([]),[l,i]=(0,p.useState)(!1),{toast:c}=(0,f.dj)(),d=(0,p.useCallback)(async()=>{if(e&&s&&t){i(!0);try{let a=(await (0,r.TH)(e,s,y.ah)).filter(e=>{var s,t;return!!(null==(s=e.metadata)?void 0:s.name)&&!!(null==(t=e.metadata)?void 0:t.namespace)}).map(e=>({name:e.metadata.name,environment:t,namespace:e.metadata.namespace,data:e.data}));n(a),sessionStorage.setItem(y.O3,s)}catch(e){c({title:"Error",description:"Failed to fetch keys.",variant:"destructive"})}finally{i(!1)}}},[e,s,t,c]);return{keyRings:a,isLoading:l,fetchKeyRings:d}}(b,i,null==v?void 0:v.name);(0,p.useEffect)(()=>{b&&i&&w()},[b,i,d,o]);let C=async e=>{if(d&&b&&i)try{let t=Object.fromEntries(e.entries.map(e=>{let{key:s,value:t}=e;return[s,t]}));await (0,r.cF)(b,i,e.namespace,e.keyName,t,y.FN),l({title:"Success",description:"Key Ring created successfully."}),s(!1),await w()}catch(e){l({title:"Error",description:"Failed to create Key Ring.",variant:"destructive"})}finally{}},F=async e=>{if(b&&i&&m)try{await (0,r.Hy)(b,i,m,e),l({title:"Success",description:"Key updated successfully."}),await w(),u(void 0)}catch(e){l({title:"Error",description:"Failed to update key.",variant:"destructive"})}finally{}},S=async e=>{if(b&&i)try{await (0,r.yE)(b,i,e.namespace,e.name),l({title:"Success",description:'Key Ring "'.concat(e.name,'" deleted successfully.')}),await w()}catch(e){l({title:"Error",description:"Failed to delete Key Ring.",variant:"destructive"})}};return t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"max-w-[1400px] w-full",children:m?(0,a.jsx)(L,{open:!0,onClose:()=>u(void 0),initialData:{entries:m.data?Object.entries(m.data).map(e=>{let[s,t]=e;return{key:s,value:atob(t)}}):[]},onSubmit:F,isLoading:k}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-end gap-2 mb-10",children:[(0,a.jsxs)("div",{className:"mr-auto",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold tracking-tight mb-2",children:"Key Rings"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Here's a list of available Key Rings!"})]}),(0,a.jsx)("div",{className:"w-[200px]",children:(0,a.jsx)(M.r,{})}),d&&(0,a.jsxs)(c.$,{className:"mt-5",onClick:()=>s(!0),children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Add"]})]}),(0,a.jsx)(n.b,{columns:x([{label:"Delete",onClick:S}]),data:g,isLoading:k,onRowClick:e=>u(e)})]})}),(0,a.jsx)(_,{open:e,onClose:()=>s(!1),onSubmit:C,isLoading:k})]}):(0,a.jsx)(H.U,{entitiesName:"resources"})}}},e=>{var s=s=>e(e.s=s);e.O(0,[83,373,965,355,964,82,58,956,689,696,598,560,494,414,890,151,260,431,347,870,358],()=>s(21468)),_N_E=e.O()}]);